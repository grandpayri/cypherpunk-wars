<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="version" content="Iteration-6.0">
    <title>CPW_PROTOCOL_SPEC | README</title>
    <style>
        :root {
            --kaspa-teal: #70C7BA;
            --kaspa-bright: #49EACB;
            --kaspa-dark: #0A0A0A;
        }
        body {
            background-color: var(--kaspa-dark);
            color: var(--kaspa-teal);
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            padding: 40px;
            max-width: 900px;
            margin: auto;
        }
        h1, h2, h3 { color: var(--kaspa-bright); border-bottom: 1px solid var(--kaspa-teal); padding-bottom: 10px; }
        code { background: #111; padding: 2px 5px; color: #ff00ff; }
        .spec-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.85rem;
        }
        .spec-table th, .spec-table td {
            border: 1px solid var(--kaspa-teal);
            padding: 10px;
            text-align: left;
        }
        .spec-table th { background: rgba(112, 199, 186, 0.1); }
        .memo-box {
            background: #000;
            border: 1px dashed var(--kaspa-bright);
            padding: 20px;
            margin: 20px 0;
            word-break: break-all;
        }
    </style>
</head>
<body>

    <h1>CYPHERPUNK WARS: STATE PROTOCOL v1.0</h1>
    <p>This document defines the <strong>On-Chain State Persistence</strong> method for the Cypherpunk Wars SPA. All game progress is stored in the Kaspa BlockDAG via <code>OP_RETURN</code> or Memo fields in a pipe-delimited format.</p>

    <h2>1. The State String</h2>
    <p>To reconstruct a session, the SPA scans the Operator's transaction history for the most recent message beginning with the Protocol ID <code>CPW1</code>.</p>

    <div class="memo-box">
        <strong>EXAMPLE PAYLOAD:</strong><br>
        CPW1|1|150|4200|0|0|500|0|0|0|0|0001100000000000000000000|0000010000000000000000000
    </div>

    <h2>2. Field Mapping (Schema)</h2>
    <table class="spec-table">
        <thead>
            <tr>
                <th>Index</th>
                <th>Field</th>
                <th>Definition</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>0</td><td>Protocol</td><td>Constant: <code>CPW1</code></td></tr>
            <tr><td>1</td><td>Season</td><td>Integer: Current era (Increments after Armageddon)</td></tr>
            <tr><td>2</td><td>Sectors</td><td>Integer: Total Data Centers / Land owned</td></tr>
            <tr><td>3</td><td>PUNKW</td><td>Integer: Current War Chest balance</td></tr>
            <tr><td>4-10</td><td>Unit Slots</td><td>7 Integers: Count of specific Daemon/Troop types</td></tr>
            <tr><td>11</td><td>Spells</td><td>Bitmask (25 chars): Binary flags for known spells</td></tr>
            <tr><td>36</td><td>Items</td><td>Bitmask (25 chars): Binary flags for owned artifacts</td></tr>
        </tbody>
    </table>

    <h2>3. Operation Logic</h2>
    <ul>
        <li><strong>Handshake:</strong> On <code>BOOT</code>, the SPA fetches UTXOs and filters for the <code>CPW1</code> prefix.</li>
        <li><strong>Action Sync:</strong> Actions like <code>PHISH</code> or <code>BUILD</code> trigger a local state update, followed by an on-chain "Save Transaction".</li>
        <li><strong>Armageddon:</strong> A victory condition that zeroes all indices except <code>Season</code>, which increments by 1.</li>
    </ul>

    <p style="text-align:center; margin-top:50px;">
        <a href="index.html" style="color:var(--kaspa-bright);">[ RETURN_TO_BUNKER ]</a>
    </p>

</body>
</html>
